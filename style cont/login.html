<!doctype html>
<html lang="id">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Login - Manufacturing Process System</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
	<style>
		body { 
			font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
			margin: 0; 
			background: #0f172a; 
			color: #e2e8f0; 
			display: flex;
			align-items: center;
			justify-content: center;
			min-height: 100vh;
		}
		.login-container {
			background: #0b1220;
			border: 1px solid #1f2937;
			border-radius: 12px;
			padding: 32px;
			width: 100%;
			max-width: 400px;
		}
		h1 {
			font-size: 24px;
			margin: 0 0 8px;
			text-align: center;
		}
		.subtitle {
			color: #94a3b8;
			text-align: center;
			margin-bottom: 24px;
			font-size: 14px;
		}
		label {
			display: block;
			margin: 16px 0 6px;
			color: #cbd5e1;
			font-size: 13px;
		}
		input, select {
			width: 100%;
			background: #0f172a;
			border: 1px solid #1f2937;
			color: #e2e8f0;
			padding: 12px;
			border-radius: 8px;
			font-size: 14px;
			box-sizing: border-box;
		}
		input:focus, select:focus {
			outline: none;
			border-color: #2563eb;
		}
		button {
			width: 100%;
			background: #2563eb;
			color: white;
			border: 0;
			border-radius: 8px;
			padding: 12px;
			cursor: pointer;
			font-size: 14px;
			font-weight: 600;
			margin-top: 24px;
		}
		button:hover {
			background: #1d4ed8;
		}
		button:disabled {
			background: #374151;
			cursor: not-allowed;
		}
		.error {
			background: #7f1d1d;
			color: #fecaca;
			padding: 12px;
			border-radius: 8px;
			margin-top: 16px;
			font-size: 13px;
			display: none;
		}
		.info {
			background: #1e293b;
			color: #cbd5e1;
			padding: 12px;
			border-radius: 8px;
			margin-top: 16px;
			font-size: 12px;
			line-height: 1.6;
		}
	</style>
</head>
<body>
	<div class="login-container">
		<h1>Manufacturing Process System</h1>
		<p class="subtitle">Silakan login untuk melanjutkan</p>
		<form id="loginForm">
			<label for="username">Username</label>
			<input type="text" id="username" required autocomplete="username" />
			
			<label for="password">Password</label>
			<input type="password" id="password" required autocomplete="current-password" />
			
			<label for="role">Login Sebagai</label>
			<select id="role" required>
				<option value="">Pilih role...</option>
				<option value="production">Orang Produksi</option>
				<option value="warehouse">Orang Warehouse</option>
			</select>
			
			<button type="submit" id="submitBtn">Login</button>
			<div id="error" class="error"></div>
		</form>
		<div class="info">
			<strong>Default Credentials:</strong><br>
			Production: username=<code>production</code>, password=<code>password123</code><br>
			Warehouse: username=<code>warehouse</code>, password=<code>password123</code>
		</div>
	</div>
	<script>
		const form = document.getElementById('loginForm');
		const errorDiv = document.getElementById('error');
		const submitBtn = document.getElementById('submitBtn');

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			const username = document.getElementById('username').value.trim();
			const password = document.getElementById('password').value;
			const role = document.getElementById('role').value;

			if (!username || !password || !role) {
				showError('Lengkapi semua field');
				return;
			}

			submitBtn.disabled = true;
			submitBtn.textContent = 'Logging in...';
			errorDiv.style.display = 'none';

			try {
				const res = await fetch('/api/login', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ username, password })
				});

				const data = await res.json();

				if (!res.ok) {
					throw new Error(data.error || 'Login gagal');
				}

				// Verify role matches
				if (data.user.role !== role) {
					throw new Error(`Role tidak sesuai. Anda login sebagai ${data.user.role === 'production' ? 'Orang Produksi' : 'Orang Warehouse'}`);
				}

				// Store token in localStorage
				localStorage.setItem('session_token', data.token);
				localStorage.setItem('user_role', data.user.role);
				localStorage.setItem('username', data.user.username);

				// Redirect to main page
				window.location.href = '/';
			} catch (error) {
				showError(error.message);
				submitBtn.disabled = false;
				submitBtn.textContent = 'Login';
			}
		});

		function showError(msg) {
			errorDiv.textContent = msg;
			errorDiv.style.display = 'block';
		}

		// Check if already logged in
		if (localStorage.getItem('session_token')) {
			window.location.href = '/';
		}
	</script>
</body>
</html>



